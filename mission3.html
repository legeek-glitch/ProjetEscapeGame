<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="utf-8">
    <meta name="author" content="Demet LE GAL">
    <meta name="co-founder" content="Louis BRYNIDSVOL-GIARD">
    <link rel="icon" type="image/x-icon" href="images/icon.png">

    <title>Escape from Russia : Mission 3</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="main">
        
    </div>
    <div id="overlay"></div>
    <div id="game-over">
        <div id="text">
            <h1>Game over!</h1>
            <p>

            </p>
        </div>
        <div id="buttons">
            <button onclick="start();" id="button">Retry</button>
            <a id="button" href="index.html">Home</a>
        </div>

    </div>

    <script>

        // Fonction python time.sleep() version JS
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // menu game over
        async function gameOver() {
            var gameover = document.getElementById("game-over");
            var overlay = document.getElementById("overlay");
            overlay.style.display = "block";
            for (let i = 0; i < 1; i += .1) {
                await sleep(50);
                overlay.style.opacity = i;
            }
            await sleep(50);
            gameover.style.display = "block";
        }

        // div dans lequel le dialog se passera
        let dialogbox

        // nouveau dialogue ou détruit le dialogue
        function Dialogue(state, type) {
            if (state) {
                dialogbox = document.createElement("div");
                dialogbox.id = `dialog-${type}`;
                document.body.appendChild(dialogbox);
            } else dialogbox.remove();
        }
        function resetDialogue(type) {
            Dialogue(false); Dialogue(true, type);
        }

        // créé un paragraphe dans le dialogue
        async function newText(textContent) {

            let text
            if (document.getElementById("dialog-text")) {
                text = document.getElementById("dialog-text");
            } else {
                text = document.createElement("p");
                text.id = "dialog-text";
                dialogbox.appendChild(text);
            }

            let clicked = false;
            dialogbox.addEventListener("click", () => { clicked = true; });

            text.innerHTML = "> ";
            for (let i = 0; i < textContent.length; i++) {
                await sleep(25);
                if (clicked) break; // si bulle de dialogue clickée, afficher le texte sans délai
                text.innerHTML += textContent[i];
            }
            text.innerHTML = `> ${textContent}`;
            clicked = false;
            await sleep(250);
            return new Promise(resolve => resolve());
        }
        // créé un boutton dans le dialogue et retourne l'élément
        function newButton(textContent) {
            var button = document.createElement("button");
            button.classList.add("dialog-button");
            button.classList.add("enabled");
            button.innerHTML = textContent;
            dialogbox.appendChild(button);
            return button
        }

        // départ
        async function start() {
            Dialogue(true, "main");
            await newText("Voici la première étape de votre échappatoire !"); await sleep(500);
            await newText("Réussissez-la avant le temps imparti pour passer à la suite."); await sleep(500);
            resetDialogue("main");
            newText("Alignez les écrous pour ouvrir la porte.");
        }
        start()
    </script>
</body>

<style>
    #main {
        width: 50%;
        height: calc(5*75px);
        padding: 10px;
        margin-left: 50%;
        margin-top: 5%;
        transform: translate(-50%);
        background: rgb(30, 30, 30);
        box-shadow: 0px 0px 5px 5px rgba(150, 150, 150, 0.1);
    }
</style>

</html>